<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Analysis of Streamflow Data using Excel</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --code-block-bg-color: inherit; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background: rgb(181, 214, 252); text-shadow: none; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: visible; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; vertical-align: middle; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.typora-export p { white-space: normal; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
figure { max-width: 100%; overflow-x: auto; margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: var(--code-block-bg-color); position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.CodeMirror-line { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: transparent; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print {
  html, body { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > img:only-child { display: block; margin: auto; }
p .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background: transparent !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; }


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 14px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(204, 204, 204); margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) {
}
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 5px; padding-bottom: 5px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.boxed { border: 0.5px solid gray; padding: 1px 12px; }






</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-n2' class='md-header-anchor '></a>Unit 1: Analysis of Streamflow Data using Excel</h1><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="n2"><a class="md-toc-inner" href="#header-n2">Unit 1: Analysis of Streamflow Data using Excel</a></span><span class="md-toc-item md-toc-h2" data-ref="n4"><a class="md-toc-inner" href="#header-n4">♦ Background: How has Falls Lake affected streamflow?</a></span><span class="md-toc-item md-toc-h2" data-ref="n12"><a class="md-toc-inner" href="#header-n12">♦ Analytical workflow: A Preview</a></span><span class="md-toc-item md-toc-h3" data-ref="n21"><a class="md-toc-inner" href="#header-n21">1. Clarifying the central question</a></span><span class="md-toc-item md-toc-h3" data-ref="n40"><a class="md-toc-inner" href="#header-n40">2. What data do I need to answer the question? Do the data exist?</a></span><span class="md-toc-item md-toc-h3" data-ref="n49"><a class="md-toc-inner" href="#header-n49">3. Obtaining, exploring, and cleaning the data</a></span><span class="md-toc-item md-toc-h3" data-ref="n54"><a class="md-toc-inner" href="#header-n54">4. Conducting the analysis and communicating the results</a></span><span class="md-toc-item md-toc-h3" data-ref="n75"><a class="md-toc-inner" href="#header-n75">5. Post-mortem: evaluation and documentation</a></span><span class="md-toc-item md-toc-h2" data-ref="n81"><a class="md-toc-inner" href="#header-n81">♦ Applying the Analytical Workflow: Falls Lake</a></span><span class="md-toc-item md-toc-h3" data-ref="n82"><a class="md-toc-inner" href="#header-n82">• Obtaining the data</a></span><span class="md-toc-item md-toc-h4" data-ref="n85"><a class="md-toc-inner" href="#header-n85">Finding the streamflow data</a></span><span class="md-toc-item md-toc-h4" data-ref="n118"><a class="md-toc-inner" href="#header-n118">Getting the data into Excel</a></span><span class="md-toc-item md-toc-h5" data-ref="n123"><a class="md-toc-inner" href="#header-n123">Method 1 -</a></span><span class="md-toc-item md-toc-h5" data-ref="n145"><a class="md-toc-inner" href="#header-n145">Method 2 -</a></span><span class="md-toc-item md-toc-h5" data-ref="n159"><a class="md-toc-inner" href="#header-n159">Method 3 -</a></span><span class="md-toc-item md-toc-h3" data-ref="n176"><a class="md-toc-inner" href="#header-n176">• Exploring the data</a></span><span class="md-toc-item md-toc-h4" data-ref="n179"><a class="md-toc-inner" href="#header-n179">Create a copy of the raw data and clean it up</a></span><span class="md-toc-item md-toc-h4" data-ref="n227"><a class="md-toc-inner" href="#header-n227">Plot streamflow data to look for gaps/outliers</a></span><span class="md-toc-item md-toc-h3" data-ref="n357"><a class="md-toc-inner" href="#header-n357">►  Exercise - Plot data in mgal/day</a></span><span class="md-toc-item md-toc-h3" data-ref="n361"><a class="md-toc-inner" href="#header-n361">♦ Summarize and plot data</a></span><span class="md-toc-item md-toc-h5" data-ref="n364"><a class="md-toc-inner" href="#header-n364">How confident are we in the data?</a></span><span class="md-toc-item md-toc-h5" data-ref="n433"><a class="md-toc-inner" href="#header-n433">Examine Summary Statistics of our Data</a></span><span class="md-toc-item md-toc-h5" data-ref="n503"><a class="md-toc-inner" href="#header-n503">Is there seasonal variation in streamflow?</a></span><span class="md-toc-item md-toc-h3" data-ref="n553"><a class="md-toc-inner" href="#header-n553">♦ Exercise: Compute total streamflow by water year</a></span><span class="md-toc-item md-toc-h2" data-ref="n557"><a class="md-toc-inner" href="#header-n557"> </a></span><span class="md-toc-item md-toc-h2" data-ref="n558"><a class="md-toc-inner" href="#header-n558">Q1: Evaluating 100-year flood frequency</a></span><span class="md-toc-item md-toc-h3" data-ref="n559"><a class="md-toc-inner" href="#header-n559">Background: Calculating return intervals</a></span><span class="md-toc-item md-toc-h3" data-ref="n576"><a class="md-toc-inner" href="#header-n576">Framing and executing the analysis</a></span><span class="md-toc-item md-toc-h4" data-ref="n583"><a class="md-toc-inner" href="#header-n583">Compute maximum annual streamflow using pivot tables</a></span><span class="md-toc-item md-toc-h4" data-ref="n612"><a class="md-toc-inner" href="#header-n612">Rank &amp; sort the pivot table data; compute return intervals</a></span><span class="md-toc-item md-toc-h5" data-ref="n653"><a class="md-toc-inner" href="#header-n653">Computing Return Interval (RI) and Annual Exceedance Probability (Pe) from ranked discharge values</a></span><span class="md-toc-item md-toc-h4" data-ref="n685"><a class="md-toc-inner" href="#header-n685">Plot the data and compute a regression equation</a></span><span class="md-toc-item md-toc-h4" data-ref="n714"><a class="md-toc-inner" href="#header-n714">Apply the regression to compute 100, 500, and 1000-year flood discharges</a></span><span class="md-toc-item md-toc-h3" data-ref="n726"><a class="md-toc-inner" href="#header-n726">♦ Exercise: Calculate the return interval from the pre-1980 data</a></span><span class="md-toc-item md-toc-h3" data-ref="n765"><a class="md-toc-inner" href="#header-n765"> </a></span><span class="md-toc-item md-toc-h2" data-ref="n767"><a class="md-toc-inner" href="#header-n767">Q2: Evaluating impact on minimum flows</a></span><span class="md-toc-item md-toc-h4" data-ref="n768"><a class="md-toc-inner" href="#header-n768">Background &amp; Framing the Analysis: 7Q10</a></span><span class="md-toc-item md-toc-h4" data-ref="n781"><a class="md-toc-inner" href="#header-n781">The analysis</a></span><span class="md-toc-item md-toc-h4" data-ref="n903"><a class="md-toc-inner" href="#header-n903">Continued practice</a></span><span class="md-toc-item md-toc-h2" data-ref="n909"><a class="md-toc-inner" href="#header-n909"> </a></span><span class="md-toc-item md-toc-h2" data-ref="n910"><a class="md-toc-inner" href="#header-n910">Q3: Exploring trends in streamflow over time</a></span><span class="md-toc-item md-toc-h3" data-ref="n911"><a class="md-toc-inner" href="#header-n911">Background</a></span><span class="md-toc-item md-toc-h3" data-ref="n914"><a class="md-toc-inner" href="#header-n914">Set up</a></span><span class="md-toc-item md-toc-h3" data-ref="n970"><a class="md-toc-inner" href="#header-n970">More Practice</a></span><span class="md-toc-item md-toc-h1" data-ref="n991"><a class="md-toc-inner" href="#header-n991">EXCEL Limitations</a></span></p></div><h2><a name='header-n4' class='md-header-anchor '></a>♦ Background: How has Falls Lake affected streamflow?</h2><p>Prior to 1978, flooding of the Neuse River caused extensive damage to public and private properties including roadways, railroads, industrial sites, and farmlands. The Falls Lake Project was developed by the U.S. Army Corps of Engineers to control damaging floods and to supply a source of water for surrounding communities. Construction of the dam began in 1978 and was completed in 1981. In addition to recreation opportunities, Falls Lake now provides flood control, water supply, water quality, and fish and wildlife conservation resources (<a href='https://www.ncparks.gov/falls-lake-state-recreation-area/history'>source</a>).</p><p>Now, some 3 dozen years after Falls Lake was constructed, we want to evaluate its impact on downstream streamflow, using this as an opportunity to examine some data analytic techniques, specifically ones using Microsoft Excel. These techniques will cover ways to get data into Excel and how to manage, wrangle, and analyze those data. </p><p>This document begins with a review of the <strong>analytical workflow</strong> of most data projects. We apply this workflow to understand how streamflow has changed since Falls Lake was constructed. In doing so, we focus on using <em>Excel</em> to tackle the assignment, but companion documents will examine how <em>R</em> and <em>Python</em> can accomplish the same set of tasks in a scripting environment.</p><hr /><h2><a name='header-n12' class='md-header-anchor '></a>♦ Analytical workflow: A Preview</h2><p>Data analysis projects follow a similar workflow, one that begins with a general question or objective that guides our process of turning data into actionable information. Let&#39;s begin by examining our workflow, depicted in the diagram below. </p><p>&nbsp;</p><p><img src='media/Data%20Analytics%20Process%20Streamflow.png' alt='Data Analytics Process Streamflow' /></p><p>&nbsp;</p><h3><a name='header-n21' class='md-header-anchor '></a>1. Clarifying the central question</h3><p>Data analysis has a workflow that often begins with clarifying the central question. For example, our initial question is <em>&quot;How has Falls Lake affected streamflow?&quot;</em> This question has some useful specifics: We know where we&#39;ll be working (Falls Lake) and what the core dataset will be (streamflow). However, the question is vague on how we might evaluate the impact on streamflow. As a data analyst your first job is often to <u>clarify a basic question into one that is <em>actionable</em></u>, that is taking a vague question and creating specific questions that shape data exploration and analysis to facilitates effective decision making. </p><p>This step usually requires some communication between the the client, project managers, experts in the field, and you, the data analyst. (And let&#39;s hope it goes better than this meeting: <a href='https://www.youtube.com/watch?v=BKorP55Aqvg' target='_blank' >https://www.youtube.com/watch?v=BKorP55Aqvg</a> .) For our Falls Lake example, however, we&#39;ll assume this meeting took place and narrowed on on the following questions:</p><ul><li>How has the 100-year flood frequency changed since building the reservoir?</li><li>How have 7-month minimum flows changed since building the reservoir?</li><li>Are there trends in streamflow (increasing, same or decreasing) since building the reservoir?</li></ul><p>While these are still a touch vague, our expert hydrologists will provide more specific guidance on these analyses below. </p><p>&nbsp;</p><h3><a name='header-n40' class='md-header-anchor '></a>2. What data do I need to answer the question? Do the data exist?</h3><p>With our objectives clarified, our next step is to <u>identify the data needed for our analyses</u>. In our case, it&#39;s fairly obvious: we need long-term streamflow data at some point downstream (and not too far downstream) from Falls Lake. In other cases, it may not be as obvious and may require another conference with the project team to figure out what that ideal dataset may be. </p><p>When a target dataset is identified, the following question is <u>whether those data exist</u>? Knowing where to look or whom to ask whether a certain dataset exists comes with experience and your networks (though web-search skills can be quite useful too). However, if you&#39;ve exhausted your search and still can&#39;t find the proper dataset(s), your fallback is to look for <strong>proxies</strong>, or similar (existing) data that can be used in place of your [missing] data. In some cases, <strong>models</strong> can be used to derive suitable data to run your analysis. </p><p>In this case, the data we want are provided by the USGS&#39; <em>National Water Information System</em> (NWIS). </p><p>&nbsp;</p><h3><a name='header-n49' class='md-header-anchor '></a>3. Obtaining, exploring, and cleaning the data</h3><p>Data come in a variety of forms and formats. Some datasets lend themselves to easy import and immediate analysis; others may not be digital-ready (e.g. hard-copies or PDFs) or have an inconsistent format rendering them essentially useless. As the saying goes, &quot;your mileage may vary&quot; with the dataset you find. While there are techniques, technologies, and some tricks in getting messy, seemingly irretrievable data into a workable format, that is not our focus. Rather, we&#39;ll cover some reliable techniques for <u>getting data into a workable, or <strong>tidy</strong> format</u> in Excel. More powerful techniques exist for obtaining and cleaning data exist in <em>R</em> and <em>Python</em> scripting languages that we&#39;ll examine a bit later.</p><p>&nbsp;</p><h3><a name='header-n54' class='md-header-anchor '></a>4. Conducting the analysis and communicating the results</h3><p>With the proper data in your analytical environment (e.g. <em>Excel</em>, <em>R</em>, <em>Python</em>), the remaining steps in the data analysis workflow involve answering your question(s). How this goes ultimately depends on your particular objectives, but in this exercise we will examine a few basic strategies for working with data. These include:</p><ul><li>Selecting and subsetting specific observations (rows) and variables (columns) of data.</li><li>Reshaping or changing the layout of your data, e.g. pivoting or transforming rows and columns</li><li>Grouping and summarizing data</li><li>Combining datasets</li><li>Graphing, charting, and plotting data</li></ul><p>&nbsp;</p><h3><a name='header-n75' class='md-header-anchor '></a>5. Post-mortem: evaluation and documentation</h3><p>Often overlooked by the data analyst is the step of reviewing your analysis and documenting your work. When you&#39;ve completed your analysis, you&#39;ll often reconvene with the team and assess whether you answered your central question effectively. If not, you&#39;ll need to tweak things until you do and perhaps cycle through the workflow again. This is where <strong>documentation</strong> can be hugely helpful. Documentation includes notes to yourself and to others covering in enough detail as to facilitate repeating the entire process. Documentation should include any non-obvious assumption or decision made in doing your analysis. This can be a bit cumbersome with Excel, but is done quite easily through comments in R or Python scripts. </p><p>&nbsp;</p><hr /><h2><a name='header-n81' class='md-header-anchor '></a>♦ Applying the Analytical Workflow: Falls Lake</h2><h3><a name='header-n82' class='md-header-anchor '></a>• Obtaining the data</h3><p>As mentioned above, we&#39;ve determined that we need streamflow data for some site below Falls Lake dam, and those data are provided via the USGS&#39; National Water Information System. The following steps outline the process of finding the appropriate gaging site and then the data we need to run our analysis. </p><h4><a name='header-n85' class='md-header-anchor '></a><u>Finding the streamflow data</u></h4><ol start='' ><li><p>Open the NWIS mapper in a browser: <a href='https://maps.waterdata.usgs.gov/mapper/index.html' target='_blank' >https://maps.waterdata.usgs.gov/mapper/index.html</a></p></li><li><p>Locate Falls Lake on the map. (Tip: Search for <code>Falls Lake, NC</code>)</p></li><li><p>On the map, visually follow the stream flowing out of Falls Lake dam until you find a gage site. Click on it, and it should reveal Site #: <code>02087500</code>, <code>NEUSE RIVER NEAR CLAYTON, NC</code>. This is the site we&#39;ll use for our analysis. </p><p><img src='media/image2.png' alt='Data Analytics Process Streamflow' /></p></li><li><p>Click on the <a href='https://waterdata.usgs.gov/nwis/inventory?agency_code=USGS&site_no=02087500'>Access Data</a> link. This brings up the interface for selecting which data you want to grab. </p></li><li><p>On this page, from the dropdown menu near the top, select <code>Time-series: Daily Data</code> and hit <code>GO</code>. This will open the form for selecting the current and historical stream flow data we want.</p></li><li><p>In this form:
- Check the box next to <code>00060 Discharge</code>;</p><p>- Select <code>Tab-separated data</code> and <code>Display in browser</code> as the output format;</p><p>- Set the From date to <code>1930-10-01</code> and the End date to <code>2017-09-30</code> (note: the &quot;water year&quot; goes from Oct. to Sept.);</p><p>- And finally hit <code>Go</code>. This will call up a page with all the data you just requested. </p><p>​     <em>*  (If needed, this <a href='https://waterdata.usgs.gov/nwis/dv?cb_00060=on&format=rdb&site_no=02087500&referred_module=sw&period=&begin_date=1930-10-01&end_date=2017-09-30'>LINK</a> will take you directly to the data...)</em></p></li></ol><p>Pause and look at what&#39;s provided. The first several lines begin with a &#39;#&#39; and display the dataset&#39;s <em>metadata</em>, i.e. data about the data. The first line without the &#39;#&#39; appears to be column headers, but the line after that looks different than the actual data values below that. (As it happens, this line indicates the data <em>length</em> and <em>type</em>: <code>5s</code> indicates a <code>s</code>tring that is <code>5</code> characters long. The other data types include <code>d</code> for <em>date</em>, and <code>n</code> for <em>numeric</em>.) </p><h4><a name='header-n118' class='md-header-anchor '></a><u>Getting the data into Excel</u></h4><p>*<em>Before embarking on our work with Excel, be sure you are clear what each of the following refers to with respect to Excel:</em> <code>workbook</code>, <code>worksheet</code>, <code>row</code>, <code>column</code>, <code>cell</code>, <code>menu options</code>.</p><p>Now that we have found the data, we need to get it into <em>Excel</em> so that each value is in its own cell. We&#39;ll discuss two, somewhat imperfect, methods to do this, each requiring a bit of manual editing. We also present a third, more automated method. However, while this third method may seem easier, it is less transparent and a bit unstable with the current release of <em>Excel</em>. <br/></p><h5><a name='header-n123' class='md-header-anchor '></a>Method 1 -</h5><ul><li>Select the entire contents of the web page containing the discharge data. (Tip: use <code>ctrl</code>-<code>a</code> )</li><li>Copy (<code>ctrl</code>-<code>c</code>) the contents from the browser and paste (<code>ctrl</code>-<code>v</code>) them into a new <em>Excel</em> worksheet. </li><li><em>Notice that the contents are lumped into a single column, which prevents us from properly working with the data. To fix this, you can use the <code>Text to Columns</code> command.</em></li><li>To convert text to data, first select the cells containing text you want to convert into columns. For us, its the entire first column, which you can select by click the header of Column <code>A</code>.</li><li>From the <code>Data</code> menu, click the <code>Text to Columns</code> command in the <code>Data Tools</code> panel. </li><li>In the wizard, specify that your data are <code>delimited</code> by a <code>space</code>, and then click <code>Finish</code>. </li></ul><p><em>This works, but not perfectly. Notice the data (starting in row 34) are in columns now, but the column headers don’t match the data fields until 2004 when minimum and maximum discharge were collected. We, need to be careful for these types of errors using this method. Let&#39;s look at an alternative method and see whether it works better...</em></p><h5><a name='header-n145' class='md-header-anchor '></a>Method 2 -</h5><ul><li>Clear the contents of your Excel spreadsheet and copy the contents of the NWIS data web page again, if necessary.</li><li>In your blank worksheet, right-click cell A1 and select <code>Paste Special...</code> from the context menu.</li><li>In the Paste Special wizard, select <code>text</code> and hit <code>OK</code>. Notice that the data are in the correct columns!</li><li>Rename the worksheet &quot;<code>Raw</code>&quot; and save your workbook. </li></ul><h5><a name='header-n159' class='md-header-anchor '></a>Method 3 -</h5><p><em>(Note, this method is somewhat buggy and may take a bit longer to run...)</em></p><ul><li>From the <code>Data</code> menu, select <code>From Web</code>. </li><li>In the <code>New Web Query</code> window, copy and paste the NWIS data web page&#39;s <a href='https://waterdata.usgs.gov/nwis/dv?cb_00060=on&format=rdb&site_no=02087500&referred_module=sw&period=&begin_date=1930-10-01&end_date=2017-09-30'>URL</a> into the <code>Address:</code> box and click <code>Go</code>.</li><li>You&#39;ll see the data appear in this window; Click the orange arrow to select the data to import.</li><li>Click the <code>import</code> button. </li></ul><hr /><h3><a name='header-n176' class='md-header-anchor '></a>• Exploring the data</h3><p>While we now have our data in Excel, we should explore and inspect the data before we dive into our analysis. This may expose irregularities in the data, stemming either from our import process or in the dataset itself. <strong>Plots</strong> and <strong>summary statistics</strong> are a quick way to reveal any data gaps or outliers. </p><h4><a name='header-n179' class='md-header-anchor '></a>Create a copy of the raw data and clean it up</h4><p>We&#39;ll begin by creating a tidier version of the raw data, but keeping the raw worksheet intact in case we make a mistake and need to revert to it. And with this copy, we&#39;ll remove the metadata and other extraneous items so that we have a clean, efficient dataset, ready for quick analysis. </p><ul><li><p><strong>Create a copy your <code>Raw</code> worksheet and rename it <code>EDA</code> (for exploratory data analysis):</strong> </p><ul><li><p>Right click the <code>Raw</code> worksheet tab, and select <code>Move or Copy...</code></p></li><li><p>Be sure, <code>create a copy</code> is checked and click <code>OK</code>. </p></li><li><p>Right click on the <code>Raw (2)</code> worksheet tab and select <code>Rename</code></p></li><li><p>Type in <code>EDA</code> as the new name</p><p>​		<strong>---All further work will be done in this EDA worksheet ---</strong></p></li></ul></li><li><p><strong>Delete the metadata rows and the data type specification row (rows 1-31 and 33):</strong></p><ul><li>Select the entire row by selecting the row number. Use <code>shift-click</code> to make continuous selections and <code>ctrl</code>-<code>click</code> to make disjunct selections.</li><li>Right-click and select <code>Delete</code>. </li></ul></li><li><p><strong>As we are only interested in <em>mean</em> discharge, we can remove the other columns:</strong> </p><ul><li><p>Delete all columns but <code>site_no</code>, <code>datetime</code>, and mean discharge, currently labeled <code>85235_00060_00003</code>. </p></li><li><p>Rename the <code>85235_00060_00003</code> as <code>Mean flow (cfs)</code></p><ul><li>How did we know the units are cfs? The metadata. Can you find this information?</li></ul><p><em>*Note: It&#39;s always good to include the units in a field name!</em></p></li></ul></li></ul><h4><a name='header-n227' class='md-header-anchor '></a>Plot streamflow data to look for gaps/outliers</h4><ul><li><p><strong>Create a scatterplot of discharge over time</strong>:</p><ul><li><p>Choose the data you want to plot:</p><ul><li>Highlight cells B1 and C1.</li><li>Press <code>ctrl</code>+<code>shift</code>+<code>↓</code> to select all data cells beneath your initial selection.</li></ul></li><li><p>Create a scatter plot with straight lines from your selected data:</p><ul><li>From the <code>Insert</code> menu, over in the <code>Charts</code> panel, select the scatterplot dropdown, and chose an appropriate chart type given the data. (Straight lines makes sense since our data are based on measurements.)</li></ul><p><em>Notice that the X-axis contains an odd sampling of dates and lots of dead space on either side. Different plot types behave differently in Excel, and scatterplots are finicky with dates, so we need to either manually adjust the x axis or chose a different plot type. We&#39;ll examine both ways...</em> </p></li><li><p>Format the X-axis to eliminate empty data space:</p><ul><li>Double-click the x-axis to open the <em>Format Axis</em> menu.</li><li>In the <em>Format Axis</em> panel, click the <em>Axis Options</em> icon (looks like a bar chart). </li><li>Notice that the axis bounds are currently set from 0 to 50,000. To set these to our data&#39;s minimum and maximum values, just type them in as dates, e.g., <code>1930-10-01</code> and <code>2017-09-30</code>. </li></ul></li><li><p><u>Or</u>, you can convert your scatterplot to a 2-d line plot.</p><ul><li>With the chart selected, and the <code>Design</code> tab active, select <code>Change Chart Type</code> to switch your scatterplot to a line plot. <em>Notice you can preview the design of a chart before committing to it.</em></li><li>Notice that the date format is much tidier with a line plot...</li></ul></li></ul></li><li><p><strong>Adjust the aesthetics of your plot</strong></p><ul><li><p>Change the title to something meaningful, such as “Neuse Streamflow near Clayton, NC”</p></li><li><p>Add a y-axis label: <code>Design</code> -&gt; <code>Add Chart Element</code> -&gt; <code>Axis Titles</code> -&gt; <code>Primary Vertical</code></p></li><li><p>Change the y-axis bounds:</p><ul><li>Set the maximum to 23,000; note the minimum drops to -2000. Change the minimum to 0</li><li>Set the display units to <em>Thousands</em>. </li><li>Delete the gridlines</li><li>Play with the colors, font sizes, borders, etc. Try setting your plot to use narrower lines to show more detail. </li></ul></li></ul></li><li><p><strong>Save your workbook...</strong></p></li></ul><p><em>You remembered that scientists like the metric system and you need to convert the data from cubic feet per second to cubic meters per second. You&#39;ll need to create a new column with the discharge values in these units and re-create a new plot. Here are the steps:</em></p><ul><li><p><strong>Add a header in column <code>D</code>: &quot;Mean flow (cms)&quot;</strong></p></li><li><p><strong>Compute cms values from your cfs ones:</strong></p><ul><li>In cell <code>D2</code>, enter the formula <code>=C2*0.028316847</code> (0.028316847 is the conversion rate from cfs to cms). </li><li>To carry this formula down to all records, double click on the bottom right corner of the <code>D2</code> cell.</li></ul></li><li><p><strong>Check that the new values appear correct:</strong></p><ul><li><p>First, lock the header row so it doesn&#39;t disappear when scrolling</p><ul><li>Click <code>ctrl</code>-<code>home</code> to set the active cell as the top left cell <code>A1</code>.</li><li>Highlight Row 1</li><li>From the View menu, select <code>Freeze Top Row</code></li><li>Scroll down and examine the Discharge (cms) data. Note the header row stays put!</li></ul></li></ul></li><li><p><strong>Re-plot the data in cubic meters per second.</strong> </p><ul><li>Select your existing plot and click on the data line. That will indicate the columns of data on which the plot was based. </li><li>Click on the side of the blue rectangle and drag it so that it covers the column D, not C. </li><li>Change the y-axis label and bounds. </li><li>Reformat other aesthetics as needed...</li></ul></li></ul><hr /><h3><a name='header-n357' class='md-header-anchor '></a>►  Exercise - Plot data in mgal/day</h3><p>Your project manager looks at the chart but doesn’t like the metric system. Add a new column to convert discharge to millions of gallons per day. Make a new plot and show side by side to the CFS plot. (1 CFS = 0.53817 MGD)</p><hr /><h3><a name='header-n361' class='md-header-anchor '></a>♦ Summarize and plot data</h3><p><u>Know your data.</u> Whenever you get data, it’s good practice to look at and understand the raw data to make sure it looks reasonable and you understand something about its quality and content. One of the first things to assess in the metadata is how confident you are in the quality of the data being used in your analysis. Is the data fit for purpose?</p><h5><a name='header-n364' class='md-header-anchor '></a>How confident are we in the data?</h5><p>Our data included data-value qualification codes, and indication of the confidence we can have in the values reported. Let&#39;s examine our data in terms of those codes. We deleted these data from the table, so we&#39;ll have to add them back in to the data in our EDA worksheet. </p><ul><li><p><strong>Add a new column header to the table in the EDA worksheet; name it <code>Confidence</code>.</strong></p><p><em>We could copy and paste the data back into our table, as we haven&#39;t moved things around. However, it&#39;s useful to know how the vertical lookup, or</em> <code>VLOOKUP</code> <em>function works to join data from on table to another using a common joining field.</em></p></li><li><p><strong>Under the <code>Confidence</code> header you just created, enter the formula: <code>=VLOOKUP(B2,Raw!$C$34:$I$31810,7,FALSE)</code></strong></p></li></ul><p><em>There&#39;s a lot going on in that VLOOKUP formula, so lets explain it.</em> </p><p><em>First, the VLOOKUP function looks up a value by matching a given value in one table to a given value in another table, specified by a range of cells. In our example, this matching value is in cell <code>B2</code>, i.e. the date <code>10/1/1930</code>. VLOOKUP searches the range of cells specified in the second argument, <code>Raw!$C$34:$I$31810</code> for that value, and returns the value in the <code>7</code>th column of that range.</em> </p><p><em>What still may be confusing is how the range of cells is defined by <code>Raw!$C$34:$I$31810</code>. Here, <code>Raw!</code> tells Excel that the range of values is in the worksheet named &quot;Raw&quot;, not the current worksheet. The range of cells in the &quot;Raw&quot; worksheet is <code>C34</code> to <code>I31801</code>, but the <code>$</code> indicates that, as we copy this formula to other cells, this range should remain static. Otherwise, if we copied the formula to the cell below it the range would dynamical update  from <code>C34:I31810</code> to <code>C35:I31811</code>, but in our case, we want the lookup range to be locked in.</em> </p><ul><li><strong>Double click the bottom corner to copy this function down to all records in our table.</strong> Now we have re-added the confidence values back to our data table!</li></ul><p>Now, let&#39;s add into our worksheet a table listing how many records are associated with each confidence value. A look at the metadata indicate three data-value qualification codes: <em>A</em>, <em>P</em>, and <em>e</em>. Let&#39;s first confirm what values are contained in our dataset. We can do this quickly by setting up a data filter:</p><ul><li><p><strong>Create a Filter for the <code>Confidence</code> column to reveal a list of unique values</strong></p><ul><li>Select the entire Confidence column.</li><li>With the <code>Home</code> menu active, select <code>Sort &amp; Filter</code>&gt;<code>Filter</code> (from the <code>Editing</code> panel)</li></ul></li></ul><p>You&#39;ll now see that the header cell has a dropdown arrow. Click this arrow and it will list all the unique values, and you&#39;ll see that our data indeed has three values, but they are slightly different than what was listed in the metadata. They are: A, A:e, and P. </p><p>Now to create the table listing how many records are associated with these three values. The <code>countif</code> tool is useful here.</p><ul><li><p><strong>Create a table listing the number of records associated with each Confidence code using COUNTIF</strong> </p><ul><li>Somewhere in your EDA worksheet, create two header cells: <code>Confidence code</code> and <code>Count</code>.</li><li>Under the <code>Confidence Code</code> header cell, enter three label cells, one for each confidence code: <code>A</code>, <code>A:e</code>, and <code>P</code>,</li><li>To the left of each label cell, start typing the formula <code>=countif(</code> </li><li>To specify the <em>range</em> portion of this formula, select the top data cell in the Confidence column (E2), and then press <code>shift</code>+ <code>ctrl</code>+<code>↓</code>. (It should result in <code>E2:E31778</code>)</li><li>To specify the <em>criteria</em> portion of the formula, select the label cell containing the confidence code you want to count. This should be immediately to the left of the cell into which you are typing the formula. The value for <code>A</code> should be <code>31601</code>.</li><li>Before copying this formula down, you need to add <code>$</code> to your range so that it remains locked in: Edit the range in your formula from  <code>E2:E31778</code> to  <code>E$2:E$31778</code>.</li><li>Now, double-click the lower right corner of the cell to copy the formula down for the other two confidence codes. </li></ul></li></ul><p>With this table you can interpret the results. What proportion of the data is reliable? Would a plot be helpful?</p><p>&nbsp;</p><h5><a name='header-n433' class='md-header-anchor '></a>Examine Summary Statistics of our Data</h5><p>Summary statistics provide another quick way to examine our data for peculiarities. Here, we&#39;ll outline the process for computing min, max, mean, and percentiles from our data in Excel. We&#39;ll simplify this procedure by creating a name for the range of <code>Mean flow (cms)</code> data cell. </p><ul><li><p>Assign <code>CMS</code> as the name of the range of <code>Mean flow (cms)</code> cells:</p><ul><li>Select all the data cells under the <code>Mean flow (cms)</code> header</li><li>Type <code>ctrl</code>-<code>F3</code> to open the Name Manager and click <code>New</code> to add a new named range of cells.</li><li>Enter CMS as the Name. Note the range is set to what we highlighted as we open the Name Manger. Click <code>OK</code>.</li><li>Close the Name Manger. Now we can just type <code>CFS</code> in any formula and it will refer to that range of cells. We&#39;ll see below how this works. </li></ul></li><li><p>Create a skeleton table with labels: <code>Min</code>, <code>P10</code>, <code>P25</code>, <code>P75</code>, <code>P90</code>, <code>Median</code>, <code>Average</code>, and <code>Max</code></p></li><li><p>Insert the appropriate formula for each, using the range of <code>Mean flow (cms)</code> cells for each. </p><ul><li><p>min: <code>=MIN(CMS)</code></p></li><li><p>P10:  <code>=PERCENTILE.INC(CMS,0.1)</code></p><ul><li><code>INC</code> means inclusive: where the percentile value must be between 0 and 1</li><li>Alternatively, <code>EXC</code> requires the percentile to be between 1/n and 1-1/n, where n is the number of elements </li><li>Calculate P25, P75, P90 following the same format</li></ul></li><li><p>median: <code>=MEDIAN(CMS)</code></p></li><li><p>average: <code>=AVERAGE(CMS)</code></p></li><li><p>max: <code>=MAX(CMS)</code></p></li></ul></li></ul><p>Now that we know how to compute summary statistics, let&#39;s examine whether building Falls Lake had a noticeable impact on these values. We can do this by computing summary statistics for subsets of the discharge data, with one subset containing the discharge before 1980, when construction of the lake started, and after 1984, after the dam was completed. </p><ul><li><p>Create named ranges for discharge data before 1980 and after 1984</p><ul><li>A quick way to do this is search for 1980 and select 12/31/1979 and up with <code>shift</code>+<code>ctrl</code>+<code>↑</code>. With these records selected, assign a name as we did above. </li><li>Then search for 1984 and select from 1/1/1984 and down (<code>shift</code>+<code>ctrl</code>+<code>↓</code>), and name that range. </li></ul></li><li><p>Compute summary stats for these new ranges as you did above. (Tip: you can use <code>ctrl</code>+<code>H</code> to replace the named range <code>CMS</code> with the new names you created for easy update.)</p></li></ul><p>What do you notice? Particularly with regards to min and max streamflow. Does that make sense given what you know about reservoirs?</p><h5><a name='header-n503' class='md-header-anchor '></a>Is there seasonal variation in streamflow?</h5><p>To examine seasonal (or monthly) variation in streamflow, we need to extract the months from our date values. We&#39;ll also convert calendar years into water years, which run from October thru September. </p><ul><li><p>Parse out the Date to include Year and Month</p><ul><li>Insert three new columns in your EDA worksheet by right-clicking on Column C and selecting <code>Insert</code> three times.</li><li>Name these columns <code>year</code>, <code>month</code>, and <code>water year</code></li><li>In the Year column, use the <code>=Year()</code> function to extract the year from the corresponding cell in the <code>datetime</code> column.</li><li>Repeat for the month column. </li><li>Change the format of these cells from <em>General</em> to <em>Number</em> by highlighting the columns and selecting <code>Number</code> from the dropdown list in the <code>Number</code> panel in the <code>Home</code> menu. </li><li>Extend these formulas to the cells below. </li></ul></li><li><p>Water year runs from October to September. We adjust the year column to account for this information using <code>IF</code></p><ul><li>Create a new column for water year. </li><li>Use the <code>IF</code> function to assign the value to the cell in the <code>year</code> column if the month value is <code>&gt;= 10</code>, otherwise, set the value of the year column minus 1:  <code>=IF(D2&gt;=10,C2,C2-1)</code>.</li><li>Change the format of the cell from General to Number, if necessary. </li><li>Extend the formula to the cells below, examining to ensure the calculations are correct. </li></ul></li><li><p>Create a table skeleton of average streamflow by month (1-12) over the different time periods (period of record, pre1980, and post1984).</p></li><li><p>Use the <code>AVERAGEIF()</code> function to compute the average discharge of records where the month equals the specified month. Here, the <em>range</em> will be the range of cells in the month column, the criteria will be the month (e.g. &#39;1&#39;), and the average range will be the range of discharge values.</p></li></ul><p>What do you observe? Would a plot of the results facilitate interpretation? </p><h3><a name='header-n553' class='md-header-anchor '></a>♦ Exercise: Compute total streamflow by water year</h3><p>Repeat the above using <code>SUMIF</code> for annual streamflow based on the water year.</p><hr /><h2><a name='header-n557' class='md-header-anchor '></a> </h2><h2><a name='header-n558' class='md-header-anchor '></a>Q1: Evaluating 100-year flood frequency</h2><h3><a name='header-n559' class='md-header-anchor '></a>Background: Calculating return intervals</h3><p>Our team hydrologist suggested that one method for evaluating the impacts of dam construction is to monitor changes in flood return intervals. Falls Lake is a flood control reservoir, so it should decrease the amount of downstream flooding.</p><p> <img src='media/image3.png' alt='image3' /></p><p><strong>Figure</strong>: Reservoirs should moderate downstream flows. There is a flood control pool to hold flood waters that can be released slowly over time. There is also a conservation pool that holds water that can be released downstream during drier conditions to meet minimum streamflow requirements.</p><p>&nbsp;</p><p>Flood insurance policy is built around the concept of the 100-year flood event. The housing industry has been working to explain what that risk actually means to homeowners with 30 year mortgages. Understanding the flood risk relative to mortage&#39;s is helpful for insurance companies to know. Has Falls Lake decreased the flood risk for downstream homes?</p><p><img src='media/image4.png' alt='image4' /></p><p>Reservoirs decrease the likelihood of downstream flooding, but that often means development occurs in areas that would have been frequently flooded prior to the reservoir. We’ve seen examples of this just his year with Hurricane Harvey.</p><p>&nbsp;</p><h3><a name='header-n576' class='md-header-anchor '></a>Framing and executing the analysis</h3><p>We will use Leopold’s (1994) flood frequency curve and the Weibull equation to calculate the recurrence interval. Here the return interval is computed as <span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.923ex" height="3.476ex" viewBox="0 -1035.3 1689 1496.6" role="img" focusable="false" style="vertical-align: -1.071ex;"><defs><path stroke-width="1" id="E2-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E2-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="E2-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E2-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(120,0)"><rect stroke="none" width="1449" height="60" x="0" y="220"></rect><g transform="translate(60,476)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMAIN-2B" x="600" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMAIN-31" x="1379" y="0"></use></g><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMATHI-6D" x="585" y="-488"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2">\frac{n+1}{m}</script> where <code>n</code> is the number of years of data and <code>m</code> is the rank of the year from largest to smallest (see this <a href='https://en.wikipedia.org/wiki/Return_period'>link</a> for more info). 	</p><p><em>* NOTE: The accuracy of a return interval is highly impacted by the length of the time series.</em></p><p>So, for us to do this analysis, we need to first compute maximum annual discharge, i.e., extract the largest discharge observed from each water year. The we sort and rank our data on max annual discharge and then compute a regression line from which we can determine the discharge of a 100 and 500 year flood. </p><h4><a name='header-n583' class='md-header-anchor '></a>Compute maximum annual streamflow using <u>pivot tables</u></h4><p>Excel&#39;s pivot tables are one of it&#39;s more powerful features, allowing you to easily extract and cross tabulate various summaries from your data. We&#39;ll use to sift through discharge records on a per-year basis and identify the largest one. </p><ul><li><p>Highlight your entire EDA table, headers and all.</p></li><li><p>From the <code>Insert</code> menu, select <code>Pivot Table</code>, choosing to place the report in a <code>New Worksheet</code>.</p></li><li><p>Rename this worksheet &quot;Flood&quot;.</p></li><li><p>In the new worksheet created, click on the Pivot Table if the <code>Pivot Table Fields</code> dialog is not shown. </p></li><li><p>In the Pivot Table Fields dialog:</p><ul><li>Drag the <code>Water year</code> field into the <code>Rows</code> section</li><li>Drag the <code>Mean discharge (cms)</code> field into the <code>Values</code> section</li><li>Using the dropdown menu next to the <code>the Mean discharge (cms)</code> item now in the <code>Values</code> section, change the <code>Value Fields Settings</code> to summarize the field by the <code>Max</code> value.<br/></li></ul></li></ul><h4><a name='header-n612' class='md-header-anchor '></a>Rank &amp; sort the pivot table data; compute return intervals</h4><p>We now have the data we want. Next we&#39;ll compute rankings and then sort the data. However, to do this we need to copy the data from the dynamic Pivot Table.</p><ul><li><p>Copy contents of your pivot table</p></li><li><p>Paste <em>the values</em> of the contents <code>right click</code>+<code>s</code>+<code>v</code>.</p></li><li><p>Delete the last row in the pasted values (the grand total).</p></li><li><p>Sort the data from largest to smallest: </p><ul><li>Select both columns of data</li><li>From the Home menu, select Sort &amp; Filter-&gt;Custom Sort </li><li>Sort data by discharge values from largest to smallest. </li></ul></li><li><p>Compute rankings in a new column named <code>rank</code></p><ul><li><p>Type in a few numbers, e.g., 1, 2, 3.</p></li><li><p>Select these numbers and double click the lower right hand corner of the selected range.</p></li><li><p><em>Alternatively, you can use the</em> <code>RANK.EQ</code> <em>function</em></p><p><em>*Note: How do these methods differ for those years with the same maximum values (ties)?</em></p></li></ul></li></ul><h5><a name='header-n653' class='md-header-anchor '></a>Computing Return Interval (RI) and Annual Exceedance Probability (Pe) from ranked discharge values</h5><p>Recall that the return interval is computed from the sorted and ranked time series data. Now that we have our data sorted and ranked, we compute RI from the number of years of data we have (plus 1), divided by the ranking of a given year&#39;s discharge. </p><ul><li><p>Calculate return intervals in a new column named <code>RI</code></p><ul><li>Determine how many years of data you have (e.g. count of year rows or max of rank).</li><li>Compute  <span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.923ex" height="3.476ex" viewBox="0 -1035.3 1689 1496.6" role="img" focusable="false" style="vertical-align: -1.071ex;"><defs><path stroke-width="1" id="E2-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E2-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="E2-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E2-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(120,0)"><rect stroke="none" width="1449" height="60" x="0" y="220"></rect><g transform="translate(60,476)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMAIN-2B" x="600" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMAIN-31" x="1379" y="0"></use></g><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E2-MJMATHI-6D" x="585" y="-488"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2">\frac{n+1}{m}</script> where <code>n</code> is the number of years of data and <code>m</code> is the rank.</li></ul></li></ul><ul><li><p>Calculate the Annual Exceedance Probability (just the inverse of RI) in a new column named <code>Pe</code></p><ul><li><span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.188ex" height="2.809ex" viewBox="0 -863.1 4817.1 1209.6" role="img" focusable="false" style="vertical-align: -0.805ex;"><defs><path stroke-width="1" id="E3-MJMATHI-50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path><path stroke-width="1" id="E3-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E3-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E3-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E3-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path><path stroke-width="1" id="E3-MJMATHI-52" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path stroke-width="1" id="E3-MJMATHI-49" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMATHI-50" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMATHI-65" x="751" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMAIN-3D" x="1495" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMAIN-31" x="2552" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMAIN-2F" x="3052" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMATHI-52" x="3553" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E3-MJMATHI-49" x="4312" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3">Pe = 1/RI</script></li></ul></li><li><p>Compute the the probability of the 100, 500, and 100 year flood occurring over the next 30 years as a binomial distribution: <span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="22.216ex" height="2.809ex" viewBox="0 -863.1 9565.1 1209.6" role="img" focusable="false" style="vertical-align: -0.805ex;"><defs><path stroke-width="1" id="E4-MJMATHI-50" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path><path stroke-width="1" id="E4-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E4-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E4-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E4-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E4-MJMAIN-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path stroke-width="1" id="E4-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="1" id="E4-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path><path stroke-width="1" id="E4-MJMATHI-54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path stroke-width="1" id="E4-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="1" id="E4-MJMAIN-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path><path stroke-width="1" id="E4-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMATHI-50" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMATHI-65" x="751" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-3D" x="1495" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-31" x="2552" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-2212" x="3274" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-5B" x="4275" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-31" x="4554" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-2212" x="5276" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-28" x="6277" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-31" x="6666" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-2F" x="7167" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMATHI-54" x="7667" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-29" x="8372" y="0"></use><g transform="translate(8761,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E4-MJMATHI-6E" x="393" y="513"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4">Pe =1 - [1-(1/T)]^n</script> where <code>T</code> is the return period (e.g. 100 years) and <code>n</code> is the number of years of interest (30 years in our case).</p><ul><li>Add three label cells: 100, 500, 1000 in a new location in your worksheet</li><li>Next to them add the formula <code>=1-(1-(1/XX))^30</code> where xx is the reference to your label cell. </li></ul></li></ul><h4><a name='header-n685' class='md-header-anchor '></a>Plot the data and compute a regression equation</h4><ul><li><p>Create a scatterplot of max discharge (y-axis) vs. recurrence interval (x-axis)</p><ul><li><p>Note: Excel will default to setting the left most column in your table to the X-axis and the other as the Y-axis, meaning your scatterplot will default to setting the X-axis to Max Discharge and the Y-axis to Recurrence Interval. You&#39;ll have to manually switch this using the <code>Select Data</code> tool. </p><ul><li>In the Select Data Source dialog, Edit the <code>RI</code> category and swap the <code>Series X values</code> and <code>Series Y values</code>.</li></ul></li></ul></li><li><p>Place the x-axis on a log scale and add minor tick marks</p></li><li><p>Add a regression line to your plot</p><ul><li>Select the points in your plot; right-click and select <code>Add Trendline</code>.</li><li>Try out different trendlines to see which has the best fit. In our case, logarithmic.</li><li>Check the box to display the equation on the chart and r2 values.</li></ul></li></ul><h4><a name='header-n714' class='md-header-anchor '></a>Apply the regression to compute 100, 500, and 1000-year flood discharges</h4><ul><li><p>Using the regression equation you just calculated and added to your chart, estimate the discharge for the 100, 500, and 1000 year events, i.e., compute <code>y</code> for <code>x</code> = 100, 500, and 1000, respectively, somewhere in your Excel worksheet. <em>These are the estimated discharge at 100, 500, and 1000 year flood events.</em> </p></li><li><p>Add those estimated discharge values to your chart. </p><ul><li><code>Select Data</code> &gt; <code>Add</code> &gt; <em>RI Year</em> goes to <code>X Values</code>, <code>Y Values</code> are the values computed from the regression.</li></ul></li></ul><h3><a name='header-n726' class='md-header-anchor '></a>♦ Exercise: Calculate the return interval from the pre-1980 data</h3><p>Repeat the above analysis only using data prior to 1980 to calculate the return interval.</p><ul><li>How many fewer years of data are used?</li></ul><ul><li><p>Plot the new dataset on top of the original plot.</p><ul><li><code>Design</code> &gt; <code>Select Data</code> &gt; <code>Add</code></li><li>Add the estimated 100 and 500 year points for each plot based on the regression.</li></ul></li><li><p>How big is the difference between the 100 and 500 year estimates?</p><ul><li>Percent is calculated relative to the smaller record (my choice)</li></ul></li><li><p>Calculate the discharge for different return periods and exceedance probabilities</p></li><li><p>Plot annual discharge and calculate the number of times the 100 year flood was surpassed for both the POR and prior to 1980</p><ul><li>Plot the estimates on the same chart. How much do they differ? Are you surprised by the results?</li></ul></li></ul><p><em>Look at the first plot you did of streamflow on the EDA spreadsheet to look at the distribution of peak events. These events are all hurricanes. How does it change your understanding of why Falls Lake doesn’t seem to impact flood frequency?</em> </p><p><em>What happens to your answer if you remove those three points?</em></p><h3><a name='header-n765' class='md-header-anchor '></a> </h3><hr /><h2><a name='header-n767' class='md-header-anchor '></a>Q2: Evaluating impact on minimum flows</h2><h4><a name='header-n768' class='md-header-anchor '></a>Background &amp; Framing the Analysis: 7Q10</h4><p>The passing of the Clean Water Act in 1972 and the Endangered Species Act in 1973 has resulted in many reservoirs having to meet downstream flow requirements for either water quality purposes or species protection. For example, at the Clayton gauge, minimum flow requirements have ranged from 184 to 404 cfs since 1983. <em>Here we want to see if Falls Lake has raised minimum flows.</em></p><p>There are many ways to approach low flow to understand how minimum streamflow has changed since Falls Lake was constructed. We will look at a common metric known as 7Q10. <u><strong>7Q10</strong> is the lowest average discharge over a one [week/month/year] period with a recurrence interval of 10 years.</u> This means there is only a 10% probability that there will be lower flows than the 7Q10 threshold in any given year. </p><p>To get more practice with pivot tables and if statements, we will calculate this metric using the 7 month period. To do this we need to construct a rolling average of monthly discharges spanning 7 month, which we can do using a series of pivot tables. </p><p>The first pivot table aggregates our daily discharge data into total monthly discharge values for each year. From this we table, we can compute a <em>7-month rolling average of minimum-flows</em> from the given month&#39;s total discharge and those from 6 months preceding it. </p><p>Next, we construct a second Pivot Table from the above data. This one aggregates the monthly data by year, extracting the minimum of the 7-month average for each year. This will enable us to compute a regression similar the one we constructed for the flood return interval, but this regression is to reveal the recurrence interval of low flows so that we can determine the streamflow of a 10% low flow event. </p><p>We then sort and rank these annual monthly-minimum values, similar to how we computed flood return intervals to compute <em>7 month minimum-flow (7Q) return interval</em> and then the <em>low flow probability of recurrence (POR)</em> of these flows, again using the same methods used for calculating flood return intervals and probabilities of recurrence. From this we can compute a regression between our yearly 7Q flows and POR, and use that regression equation to determine 7Q10, or the expected minimum flow across a span of 10 years. </p><h4><a name='header-n781' class='md-header-anchor '></a>The analysis</h4><ul><li><h5><a name='header-n784' class='md-header-anchor '></a>Create a new Pivot Table to get the average daily discharge by year and month:</h5><ul><li><p>Rename the new worksheet &quot;7Q10&quot;</p></li><li><p>Set <code>year</code> and <code>month</code> as the Pivot Table <em>rows</em>. We use year instead of Water Year to ensure the data are being read in the correct order. If we use water year, the wrong September and Octobers are matched together.</p></li><li><p>In the field settings for both <code>year</code> and <code>month</code>, change the <code>Subtotals &amp; Filters</code> to <code>None</code></p></li><li><p>Set <code>Mean Flow (cms)</code> as your Pivot Table <em>value</em>. Keep as the sum of the monthly flows (since taking lowest 7 month average, small variability in the number of days in each month is ok.</p></li><li><p>Right click the top left <code>Row Labels</code> cell, and select PivotTable Options. </p><ul><li>On the <code>Totals &amp; Filters</code> tab, un-check the two Grand Totals options. </li><li>On the <code>Display</code> tab, check &quot;Classify PivotTable layout...&quot; This &quot;flattens&quot; your table to that year is shown in one column and month in another.</li></ul></li></ul></li><li><h5><a name='header-n809' class='md-header-anchor '></a>Create a static copy of the Pivot Table values</h5><ul><li>Copy the the entire Pivot Table data and paste - as <em>values</em> - into cell <code>F2</code>. (It can go anywhere, but this will make the subsequent steps easier to follow)</li></ul></li><li><h5><a name='header-n815' class='md-header-anchor '></a>Fill all the blanks in the year column with the appropriate year.</h5><ul><li>Select all the cells in the newly pasted Year column</li><li>Click <code>Home</code> &gt; <code>Find &amp; Select</code> &gt; <code>Go To Special…</code>, and a <code>Go To Special</code> dialog box will appear.</li><li>Check the  <code>Blanks</code> option, and click <code>OK</code>. All of the blank cells have been selected. </li><li>Then input the formula “=F2” into active cell F3 without changing the selection. </li><li>Press <code>Ctrl</code> + <code>Enter</code>, Excel will copy the respective formula to all blank cells.</li><li>At this point, the filled contents are formulas, and we need to convert the formals to values. Now select the whole range, copy, and paste as values.</li></ul></li><li><h5><a name='header-n836' class='md-header-anchor '></a>Calculate the 7-month minimum flow averages (i.e., &quot;7Q&quot;)</h5><ul><li>Add a new column next to the records you just pasted. Give it the header <code>7Q</code>.</li><li>Go to the 7th cell down and set it to compute the average of the streamflow of that row and the preceding 6 rows.</li><li>Double-click the bottom corner to copy this formula down to the cells below. </li></ul></li><li><h5><a name='header-n848' class='md-header-anchor '></a>Create a new table listing the minimum flow for each year, using the above table as its source.</h5><ul><li>Hint: Use your pivot table skills. But you may want to create the table in the same worksheet.</li></ul></li><li><h5><a name='header-n854' class='md-header-anchor '></a>Compute the rank, return interval, and probability of recurrence of these minimum flows</h5><ul><li>Hint: Use the methods from the flood lesson, but remember to sort in the opposite direction!</li></ul></li><li><h5><a name='header-n860' class='md-header-anchor '></a>Plot the 7Q flow (Y) against the Probability of Recurrence (X)</h5><ul><li>Try different regression types and stick with the one with the highest R2 (but avoid <em>quadratic</em> or <em>moving averages</em>).</li></ul></li><li><h5><a name='header-n866' class='md-header-anchor '></a>Use the equation to estimate the 7Q10, i.e., the threshold where the 10% of the observed flows are smaller:</h5><ul><li>Set <code>x</code> in the regression equation to 0.10 and find <code>y</code>. This is your 7Q10. </li><li>Add the 7Q10 point to the graph using <code>Select Data...</code> with your plot active. </li></ul></li><li><h5><a name='header-n875' class='md-header-anchor '></a>Apply your results: How many months in the monthly Pivot Table fell below the estimated 7Q10?</h5><p>Here we want to produce a plot that shows when and how frequently low flows have occurred. We do this by first created a new column of just the monthly discharges falling below our 7Q10 threshold, and then creating a plot where these are highlighted against all monthly discharge values. </p><ul><li>Insert a new column to the left of your copied and pasted monthly Pivot Table results. Label it <code>Below 7Q10</code>. </li><li>Use the <code>IF</code> formula to set values in this column to the monthly discharge value if the monthly discharge was below your computed 7Q10, otherwise set to an empty string (<code>&quot;&quot;</code>). </li><li>Label the empty column to the right of this table (Column E) &quot;Date&quot; and set it cells to the 15th of the year and month of the record, using the formula <code>=Date(year,month,day)</code></li><li>Plot the monthly discharge. Then add a new series to your plot of just the ones falling under the 7Q10 (column J).</li><li>Add labels and a legend.</li></ul></li><li><h5><a name='header-n895' class='md-header-anchor '></a>Count the number of Q710 events per year:</h5><ul><li>Either use the <code>COUNTIF</code> function, or</li><li>Expand your Pivot table to include the <code>Below 7Q10</code> column and count the number of occurrences. (<code>PivotTableTools</code> &gt; <code>Change Data Source...</code>).</li></ul></li></ul><h4><a name='header-n903' class='md-header-anchor '></a>Continued practice</h4><ul><li>On your own - calculate the 7Q10 prior to Falls Lake and after Falls Lake</li></ul><hr /><h2><a name='header-n909' class='md-header-anchor '></a> </h2><h2><a name='header-n910' class='md-header-anchor '></a>Q3: Exploring trends in streamflow over time</h2><h3><a name='header-n911' class='md-header-anchor '></a>Background</h3><p>Water security is becoming increasingly important as population and water demand continue to grow. This is especially true with changing climate conditions that introduce new variability into our expectations of water supply. Briefly, we want to know whether the average annual streamflow has changed over time. </p><h3><a name='header-n914' class='md-header-anchor '></a>Set up</h3><ul><li><p>Create a new spreadsheet and name it <code>Trends</code>.</p></li><li><p>Create a table of <code>Year</code>, <code>Total Streamflow</code>, and <code>Count</code>.</p><ul><li><p>Copy and Paste the entire Water Year column from the EDA tab in the <code>Year</code> column. </p><ul><li>Remove duplicate values: <code>Data menu</code>&gt;<code>Data Tools</code>&gt;<code>Remove Duplicates</code></li></ul></li><li><p>Use <code>SUMIF</code> and <code>COUNTIF</code> to calculate the number of observations per year and the annual streamflow</p></li><li><p>Remove those years with &lt; 90% of data (i.e., fewer than 329 records in a year) , </p><ul><li>Use <code>IF</code> to calculate and flag rows.</li></ul></li></ul></li><li><p>Plot streamflow over time and add a linear trend line</p></li><li><p>Go to <code>File</code> &gt; <code>Options</code> &gt;<code>Add-ins</code> &gt; <code>Analysis Toolpack</code></p><ul><li><p><code>Data Menu</code> &gt; <code>Data Analysis</code> &gt; <code>Regression</code></p></li><li><p>Run the regression analysis on the data</p><ul><li>Turn on all the plots</li><li>Is the trend significant?</li></ul></li></ul></li><li><p>Repeat for 1930-1980 and for 1984-2017</p><ul><li>What to you observe? </li><li>Are the trends obvious? </li></ul></li></ul><h3><a name='header-n970' class='md-header-anchor '></a>More Practice</h3><p>If there are not annual trends, are there seasonal ones? What about February and August?</p><ul><li><h5><a name='header-n975' class='md-header-anchor '></a>Grab all <em>February</em> values:</h5><ul><li>Go to the working spreadsheet and <code>filter</code> by month</li><li><code>AVERAGEIF</code> the filtered data...</li></ul></li><li><h5><a name='header-n984' class='md-header-anchor '></a>Repeat the above analysis</h5><ul><li><em>What do you observe?</em></li></ul></li></ul><p>&nbsp;</p><h1><a name='header-n991' class='md-header-anchor '></a>EXCEL Limitations</h1><p>Excel is a wonderful tool; however, it also has several limitations.</p><ol start='' ><li><p>Very limited analytical pack. Indeed, many of the statistical methods used for water resources rely are non-parametric, meaning they do not assume linear relationships between x and y variables. </p></li><li><p>It is time consuming to repeat analyses over multiple sites. What if we wanted to look at all downstream gauges from Falls Lake?</p></li><li><p>It is difficult to replicate results in Excel. Sometimes data are copied and pasted as values rather than formulas. Sometimes errors are hand corrected and not marked. </p><p>​</p></li></ol><p>Statistical programs and coding are valuable tools that readily address these three limitations in excel: (1) diverse statistical packages, (2) batch capable, and (3) reproducible.</p></div>
</body>
</html>